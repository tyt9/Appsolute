create database APPSOLUTE;

create user 'APPSOLUTE'@'localhost' identified by 'APPSOLUTE';
grant all privileges on APPSOLUTE.* to 'APPSOLUTE'@'localhost';

create user 'APPSOLUTE'@'%' identified by 'APPSOLUTE';
grant all privileges on APPSOLUTE.* to 'APPSOLUTE'@'%';

CREATE TABLE `approval` (
  `approval_num` bigint NOT NULL AUTO_INCREMENT,
  `app_check` int DEFAULT 0,
  `approval_date` timestamp ,
  `app_content` int NOT NULL,
  `app_del` int DEFAULT 0,
  `app_title` varchar(500) NOT NULL,
  `document_num` bigint DEFAULT NULL,
  `emp_num` bigint NOT NULL,
  `line_num` bigint DEFAULT NULL,
  PRIMARY KEY (`approval_num`),
  FOREIGN KEY (app_content) REFERENCES approval_content_detail(app_content_num),
  FOREIGN KEY (document_num) REFERENCES document(document_num),
  FOREIGN KEY (emp_num) REFERENCES employee(emp_num),
  FOREIGN KEY (line_num) REFERENCES approval_line(line_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `approval_content_detail` (
  `app_content_num` int auto_increment primary key,
  `approval_num` bigint NOT NULL,
  `document_num` bigint NOT NULL,
  `key1` varchar(50) DEFAULT NULL,
  `key2` varchar(50) DEFAULT NULL,
  `key3` varchar(50) DEFAULT NULL,
  `key4` varchar(50) DEFAULT NULL,
  `key5` varchar(50) DEFAULT NULL,
  `key6` varchar(50) DEFAULT NULL,
  `key7` varchar(50) DEFAULT NULL,
  `key8` varchar(50) DEFAULT NULL,
  `key9` varchar(50) DEFAULT NULL,
  `value1` varchar(50) DEFAULT NULL,
  `value2` varchar(50) DEFAULT NULL,
  `value3` varchar(50) DEFAULT NULL,
  `value4` varchar(50) DEFAULT NULL,
  `value5` varchar(50) DEFAULT NULL,
  `value6` varchar(50) DEFAULT NULL,
  `value7` varchar(50) DEFAULT NULL,
  `value8` varchar(50) DEFAULT NULL,
  `value9` varchar(50) DEFAULT NULL,
  `note` varchar(2000),
  FOREIGN KEY (document_num) REFERENCES document(document_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `approval_detail` (
  `approval_detail_num` bigint NOT NULL AUTO_INCREMENT,
  `emp_check_num` bigint DEFAULT NULL,
  `app_detail_seq` int NOT NULL,
  `check_date` timestamp,
  `approval_line_num` bigint DEFAULT NULL,
  `approval_num` bigint NOT NULL,
  `approval_status` int DEFAULT 0,
  `reject_reason` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`approval_detail_num`),
  FOREIGN KEY (approval_line_num) REFERENCES approval_line(line_num),
  FOREIGN KEY (approval_num) REFERENCES approval(approval_num),
  FOREIGN KEY (emp_check_num) REFERENCES employee(emp_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `approval_line` (
  `line_num` bigint NOT NULL AUTO_INCREMENT,
  `emp_num` bigint NOT NULL,
  `line_del` int DEFAULT 0,
  `line_name` bigint NOT NULL,
  PRIMARY KEY (`line_num`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `approval_line_detail` (
  `line_detail_num` bigint NOT NULL AUTO_INCREMENT,
  `line_num` bigint NOT NULL,
  `employee` bigint NOT NULL,
  `line_detail_seq` int NOT NULL,
  PRIMARY KEY (`line_detail_num`),
  FOREIGN KEY (line_num) REFERENCES approval_line(line_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `dept` (
  `dept_no` bigint NOT NULL AUTO_INCREMENT,
  `dept_name` varchar(20) NOT NULL,
  `dept_branch` int NOT NULL DEFAULT 0,
  `dept_loc` varchar(30) NOT NULL,
  PRIMARY KEY (`dept_no`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `document` (
  `document_num` bigint NOT NULL AUTO_INCREMENT,
  `document_name` varchar(255) NOT NULL,
  PRIMARY KEY (`document_num`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `document_detail` (
  `document_num` bigint NOT NULL,
  `document_detail_num` int auto_increment primary key,
  `field_name` varchar(255) NOT NULL,
  `format` int DEFAULT NULL,
  FOREIGN KEY (document_num) REFERENCES document(document_num)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `employee` (
  `emp_num` bigint NOT NULL AUTO_INCREMENT,
  `dept_no` bigint NOT NULL,
  `emp_email` varchar(100) NOT NULL,
  `emp_hire_date` timestamp DEFAULT NULL,
  `emp_leader` int NOT NULL DEFAULT 0,
  `emp_mgr` int DEFAULT NULL,
  `emp_name` varchar(30) NOT NULL,
  `emp_password` varchar(50) NOT NULL,
  `emp_phone` varchar(50) NOT NULL,
  `emp_position` varchar(20) NOT NULL,
  PRIMARY KEY (`emp_num`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

alter table employee add constraint dept_no
foreign key(dept_no) references dept(dept_no);

alter table employee modify emp_hire_date timestamp;

ALTER TABLE approval_content_detail
ADD CONSTRAINT unique_approval_num UNIQUE (approval_num);

ALTER TABLE approval_content_detail
ADD CONSTRAINT fk_approval_num
FOREIGN KEY (approval_num)
REFERENCES approval(approval_num);



INSERT INTO dept (dept_name, dept_branch, dept_loc) VALUES
('부서1', 1, '지점1'),
('부서2', 1, '지점1'),
('부서3', 2, '지점2');


INSERT INTO document (document_name) VALUES
('문서1'),
('문서2'),
('문서3');


INSERT INTO employee (dept_no, emp_email, emp_hire_date, emp_leader, emp_mgr, emp_name, emp_password, emp_phone, emp_position) VALUES
(4, 'emp1@example.com', '2023-01-01', 1, NULL, '직원1', 'password1', '123-4567-8901', '직급1'),
(5, 'emp2@example.com', '2023-02-01', 0, 1, '직원2', 'password2', '234-5678-9012', '직급2'),
(6, 'emp3@example.com', '2023-03-01', 0, 1, '직원3', 'password3', '345-6789-0123', '직급3');


INSERT INTO approval (app_check, approval_date, app_content, app_del, app_title, document_num, emp_num, line_num) VALUES
(0, '2023-01-15', 1, 0, '승인 문서 1', 1, 4, 1),
(1, '2023-02-15', 2, 0, '승인 문서 2', 2, 5, 2),
(0, '2023-03-15', 3, 0, '승인 문서 3', 3, 6, 3);


INSERT INTO approval_content_detail (approval_num, document_num, key1, key2, key3, key4, key5, key6, key7, key8, key9, value1, value2, value3, value4, value5, value6, value7, value8, value9, note) VALUES
(4, 1, 'Key1', 'Key2', 'Key3', 'Key4', 'Key5', 'Key6', 'Key7', 'Key8', 'Key9', 'Value1', 'Value2', 'Value3', 'Value4', 'Value5', 'Value6', 'Value7', 'Value8', 'Value9', 'Note1'),
(5, 2, 'Key1', 'Key2', 'Key3', 'Key4', 'Key5', 'Key6', 'Key7', 'Key8', 'Key9', 'Value1', 'Value2', 'Value3', 'Value4', 'Value5', 'Value6', 'Value7', 'Value8', 'Value9', 'Note2'),
(6, 3, 'Key1', 'Key2', 'Key3', 'Key4', 'Key5', 'Key6', 'Key7', 'Key8', 'Key9', 'Value1', 'Value2', 'Value3', 'Value4', 'Value5', 'Value6', 'Value7', 'Value8', 'Value9', 'Note3');


INSERT INTO approval_detail (emp_check_num, app_detail_seq, check_date, approval_line_num, approval_num, approval_status, reject_reason) VALUES
(4, 1, '2023-01-20', 1, 4, 1, NULL),
(5, 2, '2023-02-20', 2, 5, 1, NULL),
(6, 3, '2023-03-20', 3, 6, 0, '반려 사유1');


INSERT INTO approval_line (emp_num, line_del, line_name) VALUES
(1, 0, 1),
(2, 0, 2),
(3, 0, 3);


INSERT INTO approval_line_detail (line_num, employee, line_detail_seq) VALUES
(1, 1, 1),
(2, 2, 2),
(3, 3, 3);
